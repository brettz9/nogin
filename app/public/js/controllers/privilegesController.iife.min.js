!function(){"use strict";function e(e,t,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}"undefined"==typeof Error&&(window.Error=e((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})));var t=function(e){var t=e.type,r=e.header,i=e.body,o=e.cancel,n=e.submit,a='[data-confirm-type="'.concat(t,'"][data-name=modal-confirm]');return $(a).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(a," .modal-header [data-name=modal-title]")).text(r),$("".concat(a," [data-name=modal-body] p")).empty().append(i),$("".concat(a," .cancel")).text(o).on("click",(function(){$(a).modal("hide")})),$("".concat(a," .submit")).text(n),$(a)},r=function(e){return e.find(".submit")},i=function(e){var t=e.heading,r=e.body,i=e.keyboard,o=e.backdrop,n=$("[data-name=modal-alert]").modal({show:!1,keyboard:i,backdrop:o});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(r),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),n.modal("hide")})),n},o=Nogin._;function n(e){var t=e.type,r=e.message,n=e.privilege,a=e.heading;return i({heading:o(a),body:r||o(t,n?{lb:$("<br/>")[0],privilege:n}:{},{throwOnExtraSuppliedFormatters:!1}),keyboard:!1,backdrop:"static"})}var a={getLockedAlertButton:function(e){return e.find("button")},getDeletePrivileges:function(){return $("button.deletePrivilege")},getRemovePrivilegeFromGroup:function(){return $("button.removePrivilegeFromGroup")},createPrivilegeModal:function(){var e=$("#createPrivilege");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},editPrivilegeModal:function(){var e=$("#editPrivilege");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},addPrivilegeToGroupModal:function(){var e=$("#addPrivilegeToGroup");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},createPrivilegeForm:function(e){return e.find("#createPrivilege-form")},editPrivilegeForm:function(e){return e.find("#editPrivilege-form")},addPrivilegeToGroupForm:function(e){return e.find("#addPrivilegeToGroup-form")},createPrivilegeSubmit:function(e){return e.find("[data-name=createPrivilege-submit]")},addPrivilegeToGroupSubmit:function(e){return e.find("[data-name=addPrivilegeToGroup-submit]")},editPrivilegeSubmit:function(e){return e.find("[data-name=editPrivilege-submit]")},createPrivilegeCancel:function(e){return e.find("[data-name=createPrivilege-cancel]")},addPrivilegeToGroupCancel:function(e){return e.find("[data-name=addPrivilegeToGroup-cancel]")},editPrivilegeCancel:function(e){return e.find("[data-name=editPrivilege-cancel]")},getCreatePrivilegeButton:function(){return $("button.createPrivilege")},getEditPrivilegeButton:function(){return $("button.editPrivilege")},getAddPrivilegeToGroupButton:function(){return $("button.addPrivilegeToGroup")},getCreatePrivilegeName:function(){return $("#createPrivilege-input")[0]},getCreatePrivilegeDescription:function(){return $("#createPrivilege-description-input")[0]},getEditPrivilegeDescription:function(){return $("#editPrivilege-description-input")[0]},getAddPrivilegeToGroupGroup:function(){return $("#addPrivilegeToGroup-input")[0]},getEditPrivilege:function(){return $("#editPrivilege-input")[0]},setDeletePrivilege:function(e){var r=t({type:"deletePrivilege",header:o("deletePrivilege"),body:o("sureWantDeletePrivilege",{privilege:e}),cancel:o("cancel"),submit:o("delete")});return r.find(".submit").addClass("btn-danger"),r},setRemovePrivilegeFromGroup:function(){var e=t({type:"removePrivilegeFromGroup",header:o("removePrivilegeFromGroup"),body:o("reallyWantRemovePrivilegeFromGroup"),cancel:o("cancel"),submit:o("delete")});return e.find(".submit").addClass("btn-danger"),e},onShowLockedAlert:function(e){return n({type:e.type,privilege:e.privilege,heading:"success"})},onShowLockedErrorAlert:function(e){var t=e.type,r=e.privilege;return n({type:t,message:e.message,privilege:r,heading:"error"})},errorMessages:{name:{PleaseEnterName:o("PleaseEnterName")}}};function u(){}var l=s((function(){return E.modal("hide"),y(D(Nogin.Routes.accessAPI,{verb:"deletePrivilege",privilegeName:w}),(function(){R({type:"privilegeDeleted"})}))}));function d(e,t){return e&&e.then?e.then(u):Promise.resolve()}var c=s((function(e,t){return y(D(Nogin.Routes.accessAPI,{verb:"addPrivilegeToGroup",groupName:e,privilegeName:t}),(function(){C.modal("hide"),R({type:"privilegeAddedToGroup"})}))}));function v(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var g=s((function(e,t,r){return y(D(Nogin.Routes.accessAPI,{verb:"editPrivilege",privilegeName:e,newPrivilegeName:t,description:r}),(function(){G.modal("hide"),R({type:"privilegeEdited"})}))}));function s(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var m=s((function(e,t){return y(D(Nogin.Routes.accessAPI,{verb:"createPrivilege",privilegeName:e,description:t}),(function(){k.modal("hide"),R({type:"privilegeCreated"})}))}));var p=s((function(e,t){return S.modal("hide"),y(D(Nogin.Routes.accessAPI,{verb:"removePrivilegeFromGroup",groupName:e,privilegeName:t}),(function(){R({type:"privilegeRemovedFromGroup"})}))}));function f(e,t){return function(e,t,r){try{var i=Promise.resolve(e());return t?i.then(t):i}catch(e){return Promise.reject(e)}}(e,u)}var P=$('meta[name="csrf-token"]').attr("content");function h(e){if(e&&e.then)return e.then(u)}var b=a.getCreatePrivilegeButton();function y(e,t,r){return e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e}var k=a.createPrivilegeModal(),T=a.createPrivilegeForm(k);T.on("submit",(function(e){e.preventDefault()})),b.on("click",(function(){a.createPrivilegeCancel(k).on("click",(function(){k.modal("hide")})),k.modal("show"),a.createPrivilegeSubmit(k).on("click",s((function(){return v((function(){var e=a.getCreatePrivilegeName();if(e.validity.tooShort)return e.setCustomValidity(a.errorMessages.name.PleaseEnterName),void T[0].reportValidity();var t=a.getCreatePrivilegeDescription();return d(m(e.value,t.value))}),(function(e){k.modal("hide");var t=e;console.log("err",t),console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),M({message:t.text})}))})))}));var x=a.getEditPrivilegeButton(),G=a.editPrivilegeModal(),N=a.editPrivilegeForm(G);N.on("submit",(function(e){e.preventDefault()})),x.on("click",(function(e){var t=e.target.dataset.privilege,r=e.target.dataset.description,i=a.getEditPrivilege();a.editPrivilegeCancel(G).on("click",(function(){G.modal("hide")})),G.modal("show"),i.value=t;var o=a.getEditPrivilegeDescription();o.value=r,a.editPrivilegeSubmit(G).on("click",s((function(){return v((function(){if(i.validity.tooShort)return i.setCustomValidity(a.errorMessages.name.PleaseEnterName),void N[0].reportValidity();var e=i.value,r=o.value;return d(g(t,e,r))}),(function(e){G.modal("hide");var t=e;console.log("err",t),console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),M({message:t.text})}))})))}));var w,E,F=a.getAddPrivilegeToGroupButton(),C=a.addPrivilegeToGroupModal(),A=a.addPrivilegeToGroupForm(C);A.on("submit",(function(e){e.preventDefault()})),F.on("click",(function(e){var t=e.target.dataset.privilege,r=a.getAddPrivilegeToGroupGroup();a.addPrivilegeToGroupCancel(C).on("click",(function(){C.modal("hide")})),C.modal("show"),a.addPrivilegeToGroupSubmit(C).on("click",s((function(){return v((function(){return r.validity.tooShort?(r.setCustomValidity(a.errorMessages.name.PleaseEnterName),void A[0].reportValidity()):d(c(r.value,t))}),(function(e){C.modal("hide");var t=e;console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),M({message:t.text})}))})))})),a.getDeletePrivileges().on("click",(function(e){w=e.target.dataset.privilege,E=a.setDeletePrivilege(w),r(E).on("click",s((function(){return h(v((function(){return f(l)}),(function(e){var t=e;console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),M({message:t.text})})))}))),E.modal("show")}));var S=a.setRemovePrivilegeFromGroup();function D(e,t){var r={type:"post",headers:{"X-XSRF-Token":P}};return t&&(r.data=t),new Promise((function(t,i){$.ajax(e,r).done(t).fail((function(e){var t=new Error("Ajax POST error");t.text=e.responseText,t.responseText=e.statusText,i(t)}))}))}function R(e){var t=e.type,r=a.onShowLockedAlert({type:t,privilege:w});r.modal("show");var i=function(){location.reload(!0)};a.getLockedAlertButton(r).on("click",i),setTimeout(i,3e3)}function M(e){var t=e.type,r=e.message,i=a.onShowLockedErrorAlert({type:t,message:r,privilege:w});i.modal("show");var o=function(){location.reload(!0)};a.getLockedAlertButton(i).on("click",o),setTimeout(o,3e3)}a.getRemovePrivilegeFromGroup().on("click",(function(e){var t=e.target.dataset.group,i=e.target.dataset.privilege;r(S).on("click",s((function(){return h(v((function(){return d(p(t,i))}),(function(e){var t=e;console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),M({message:t.text})})))}))),S.modal("show")}))}();
//# sourceMappingURL=privilegesController.iife.min.js.map
