!function(){"use strict";var e=$('meta[name="csrf-token"]').attr("content");function t(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(n=r.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n,"string"))?o:String(o)),r)}var n,o}var a=Nogin._,r={getForm:function(){return $("[data-name=account-form]")[0]},getUserId:function(){return $("#userId")},getFormFields:function(){return{name:$('[data-name="name"]')[0],email:$('[data-name="email"]')[0],user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0],passConfirm:$('[data-name="pass-confirm"]')&&$('[data-name="pass-confirm"]')[0]}},errorMessages:{name:{PleaseEnterName:a("PleaseEnterName")},email:{emailAddressAlreadyInUse:a("emailAddressAlreadyInUse"),PleaseEnterValidEmail:a("PleaseEnterValidEmail")},user:{userNameAlreadyInUse:a("userNameAlreadyInUse"),PleaseChooseUserName:a("PleaseChooseUserName")},pass:{PasswordMinimumLength:a("PasswordMinimumLength"),PasswordsDontMatch:a("PasswordsDontMatch")}}},n=function(){function e(){var t=this,a=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).signup;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.signup=a,this.form=r.getForm(),this.formFields=r.getFormFields(),this.userId=r.getUserId(),this.errorMessages=r.errorMessages,this.userIsLoggedIn=function(e){return Boolean(t.userId.val())&&""===e}}var a,n,o;return a=e,n=[{key:"showInvalidEmail",value:function(){this.formFields.email.setCustomValidity(this.errorMessages.email.emailAddressAlreadyInUse),this.form.reportValidity()}},{key:"showInvalidUserName",value:function(){this.formFields.user.setCustomValidity(this.errorMessages.user.userNameAlreadyInUse),this.form.reportValidity()}},{key:"validateForm",value:function(){var e=this.formFields,t=e.name,a=e.email,r=e.user,n=e.pass,o=e.passConfirm;return Object.values(this.formFields).forEach((function(e){e&&e.setCustomValidity("")})),t.validity.tooShort&&t.setCustomValidity(this.errorMessages.name.PleaseEnterName),a.validity.patternMismatch&&a.setCustomValidity(this.errorMessages.email.PleaseEnterValidEmail),r.validity.tooShort&&r.setCustomValidity(this.errorMessages.user.PleaseChooseUserName),!this.userIsLoggedIn(n.value)&&n.validity.tooShort&&n.setCustomValidity(this.errorMessages.pass.PasswordMinimumLength),this.signup&&n.value!==o.value&&n.setCustomValidity(this.errorMessages.pass.PasswordsDontMatch),this.form.reportValidity()}}],n&&t(a.prototype,n),o&&t(a,o),Object.defineProperty(a,"prototype",{writable:!1}),e}(),o=function(e){var t=e.heading,a=e.body,r=e.keyboard,n=e.backdrop,o=$("[data-name=modal-alert]").modal({show:!1,keyboard:r,backdrop:n});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(a),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),o.modal("hide")})),o},s=Nogin._,i={getName:function(){return $("#name-tf")},getAccountCreatedOkButton:function(e){return e.find("[data-name=ok]")},getActionForAccountForm:function(e){return e.find("[data-name=action1]")},setAccountSettings:function(){var e,t,a,r,n,o;return e="[data-name=account-form]",t={heading:s("Signup"),subheading:s("PleaseTellUsAboutYourself"),action1:s("Cancel"),action2:s("Submit")},a=t.heading,r=t.subheading,n=t.action1,o=t.action2,$(e+" h1.dialog").text(a),$(e+" h2.dialog").text(r),$(e+" [data-name=action1]").text(n),$(e+" [data-name=action2]").text(o),$(e)},accountCreated:function(){return o({heading:s("AccountCreatedSignup"),body:s("PleaseCheckEmailForVerificationLink",{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})},onShowLockedErrorAlert:function(e){var t=e.type;return o({heading:s("error"),body:s(t,{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})}};i.getName().focus();var d,l,u,m,c,f,h,g,v,y,p=i.setAccountSettings(),b=function(){Nogin.redirect("root")};i.getActionForAccountForm(p).on("click",b),d=new n({signup:!0}),l=p,m=(u={checkXSRF:!1,validate:function(){d.validateForm()},success:function(e,t){var a;"success"===t&&(a=i.accountCreated(),i.getAccountCreatedOkButton(a).on("click",(function(){setTimeout(b,3e3)})),a.modal("show"))},error:function(e){switch(e.responseText){case"email-taken":d.showInvalidEmail();break;case"username-taken":d.showInvalidUserName();break;default:i.onShowLockedErrorAlert({type:"DispatchActivationLinkError"}).modal("show")}}}).validate,c=u.url,f=u.beforeSubmit,h=u.success,g=u.error,v=u.checkXSRF,y=void 0===v||v,l[0].addEventListener("change",(function(e){m(e)}),!0),l[0].addEventListener("input",(function(e){var t=e.target;t.setCustomValidity(""),t.checkValidity()}),!0),!y||e||Nogin.disableXSRF?l.ajaxForm({headers:{"X-XSRF-Token":e},url:c,beforeSubmit:f,success:h,error:g}):g({responseText:"UnknownError"})}();
//# sourceMappingURL=signupController.iife.min.js.map
