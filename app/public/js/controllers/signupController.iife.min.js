!function(){"use strict";var e=$('meta[name="csrf-token"]').attr("content");function t(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var r=Nogin._,n={getForm:function(){return $("[data-name=account-form]")[0]},getUserId:function(){return $("#userId")},getFormFields:function(){return{name:$('[data-name="name"]')[0],email:$('[data-name="email"]')[0],user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0],passConfirm:$('[data-name="pass-confirm"]')&&$('[data-name="pass-confirm"]')[0]}},errorMessages:{name:{PleaseEnterName:r("PleaseEnterName")},email:{emailAddressAlreadyInUse:r("emailAddressAlreadyInUse"),PleaseEnterValidEmail:r("PleaseEnterValidEmail")},user:{userNameAlreadyInUse:r("userNameAlreadyInUse"),PleaseChooseUserName:r("PleaseChooseUserName")},pass:{PasswordMinimumLength:r("PasswordMinimumLength"),PasswordsDontMatch:r("PasswordsDontMatch")}}},o=function(){return t((function e(){var t=this,a=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).signup;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.signup=a,this.form=n.getForm(),this.formFields=n.getFormFields(),this.userId=n.getUserId(),this.errorMessages=n.errorMessages,this.userIsLoggedIn=function(e){return Boolean(t.userId.val())&&""===e}}),[{key:"showInvalidEmail",value:function(){this.formFields.email.setCustomValidity(this.errorMessages.email.emailAddressAlreadyInUse),this.form.reportValidity()}},{key:"showInvalidUserName",value:function(){this.formFields.user.setCustomValidity(this.errorMessages.user.userNameAlreadyInUse),this.form.reportValidity()}},{key:"validateForm",value:function(){var e=this.formFields,t=e.name,a=e.email,r=e.user,n=e.pass,o=e.passConfirm;return Object.values(this.formFields).forEach((function(e){e&&e.setCustomValidity("")})),t.validity.tooShort&&t.setCustomValidity(this.errorMessages.name.PleaseEnterName),a.validity.patternMismatch&&a.setCustomValidity(this.errorMessages.email.PleaseEnterValidEmail),r.validity.tooShort&&r.setCustomValidity(this.errorMessages.user.PleaseChooseUserName),!this.userIsLoggedIn(n.value)&&n.validity.tooShort&&n.setCustomValidity(this.errorMessages.pass.PasswordMinimumLength),this.signup&&n.value!==o.value&&n.setCustomValidity(this.errorMessages.pass.PasswordsDontMatch),this.form.reportValidity()}}])}(),s=function(e){var t=e.heading,a=e.body,r=e.keyboard,n=e.backdrop,o=$("[data-name=modal-alert]").modal({show:!1,keyboard:r,backdrop:n});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(a),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),o.modal("hide")})),o},i=Nogin._,d={getName:function(){return $("#name-tf")},getAccountCreatedOkButton:function(e){return e.find("[data-name=ok]")},getActionForAccountForm:function(e){return e.find("[data-name=action1]")},setAccountSettings:function(){var e,t,a,r,n,o;return e="[data-name=account-form]",t={heading:i("Signup"),subheading:i("PleaseTellUsAboutYourself"),action1:i("Cancel"),action2:i("Submit")},a=t.heading,r=t.subheading,n=t.action1,o=t.action2,$(e+" h1.dialog").text(a),$(e+" h2.dialog").text(r),$(e+" [data-name=action1]").text(n),$(e+" [data-name=action2]").text(o),$(e)},accountCreated:function(){return s({heading:i("AccountCreatedSignup"),body:i("PleaseCheckEmailForVerificationLink",{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})},onShowLockedErrorAlert:function(e){var t=e.type;return s({heading:i("error"),body:i(t,{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})}};d.getName().focus();var u,l,c,m,f,h,g,y,p,v,b=d.setAccountSettings(),k=function(){Nogin.redirect("root")};d.getActionForAccountForm(b).on("click",k),u=new o({signup:!0}),l=b,m=(c={checkXSRF:!1,validate:function(){u.validateForm()},success:function(e,t){var a;"success"===t&&(a=d.accountCreated(),d.getAccountCreatedOkButton(a).on("click",(function(){setTimeout(k,3e3)})),a.modal("show"))},error:function(e){switch(e.responseText){case"email-taken":u.showInvalidEmail();break;case"username-taken":u.showInvalidUserName();break;default:d.onShowLockedErrorAlert({type:"DispatchActivationLinkError"}).modal("show")}}}).validate,f=c.url,h=c.beforeSubmit,g=c.success,y=c.error,p=c.checkXSRF,v=void 0===p||p,l[0].addEventListener("change",(function(e){m(e)}),!0),l[0].addEventListener("input",(function(e){var t=e.target;t.setCustomValidity(""),t.checkValidity()}),!0),!v||e||Nogin.disableXSRF?l.ajaxForm({headers:{"X-XSRF-Token":e},url:f,beforeSubmit:h,success:g,error:y}):y({responseText:"UnknownError"})}();
//# sourceMappingURL=signupController.iife.min.js.map
