!function(){"use strict";var e=$('meta[name="csrf-token"]').attr("content");function t(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var r=Nogin._,n={getForm:function(){return $("[data-name=account-form]")[0]},getUserId:function(){return $("#userId")},getFormFields:function(){return{name:$('[data-name="name"]')[0],email:$('[data-name="email"]')[0],user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0],passConfirm:$('[data-name="pass-confirm"]')&&$('[data-name="pass-confirm"]')[0]}},errorMessages:{name:{PleaseEnterName:r("PleaseEnterName")},email:{emailAddressAlreadyInUse:r("emailAddressAlreadyInUse"),PleaseEnterValidEmail:r("PleaseEnterValidEmail")},user:{userNameAlreadyInUse:r("userNameAlreadyInUse"),PleaseChooseUserName:r("PleaseChooseUserName")},pass:{PasswordMinimumLength:r("PasswordMinimumLength"),PasswordsDontMatch:r("PasswordsDontMatch")}}},o=function(){return t((function e(){var t=this,a=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).signup;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.signup=a,this.form=n.getForm(),this.formFields=n.getFormFields(),this.userId=n.getUserId(),this.errorMessages=n.errorMessages,this.userIsLoggedIn=function(e){return Boolean(t.userId.val())&&""===e}}),[{key:"showInvalidEmail",value:function(){this.formFields.email.setCustomValidity(this.errorMessages.email.emailAddressAlreadyInUse),this.form.reportValidity()}},{key:"showInvalidUserName",value:function(){this.formFields.user.setCustomValidity(this.errorMessages.user.userNameAlreadyInUse),this.form.reportValidity()}},{key:"validateForm",value:function(){var e=this.formFields,t=e.name,a=e.email,r=e.user,n=e.pass,o=e.passConfirm;return Object.values(this.formFields).forEach((function(e){e&&e.setCustomValidity("")})),t.validity.tooShort&&t.setCustomValidity(this.errorMessages.name.PleaseEnterName),a.validity.patternMismatch&&a.setCustomValidity(this.errorMessages.email.PleaseEnterValidEmail),r.validity.tooShort&&r.setCustomValidity(this.errorMessages.user.PleaseChooseUserName),!this.userIsLoggedIn(n.value)&&n.validity.tooShort&&n.setCustomValidity(this.errorMessages.pass.PasswordMinimumLength),this.signup&&n.value!==o.value&&n.setCustomValidity(this.errorMessages.pass.PasswordsDontMatch),this.form.reportValidity()}}])}(),i=function(e){var t=e.heading,a=e.body,r=e.keyboard,n=e.backdrop,o=$("[data-name=modal-alert]").modal({show:!1,keyboard:r,backdrop:n});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(a),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),o.modal("hide")})),o},s=function(e){var t=e.type,a=e.header,r=e.body,n=e.cancel,o=e.submit,i='[data-confirm-type="'.concat(t,'"][data-name=modal-confirm]');return $(i).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(i," .modal-header [data-name=modal-title]")).text(a),$("".concat(i," [data-name=modal-body] p")).empty().append(r),$("".concat(i," .cancel")).text(n).on("click",(function(){$(i).modal("hide")})),$("".concat(i," .submit")).text(o),$(i)},c=function(e){return e.find(".submit")},u=Nogin._,d={getName:function(){return $("#name-tf")},getAccountForm:function(){return $("#account-form")},setConfirmSignup:function(){return s({type:"signupAgreement",header:u("SignupAgreement"),body:$("<div>".concat(Nogin.signupAgreement,"</div>"))[0],cancel:u("cancel"),submit:u("agree")})},getAccountCreatedOkButton:function(e){return e.find("[data-name=ok]")},getActionForAccountForm:function(e){return e.find("[data-name=action1]")},setAccountSettings:function(){var e,t,a,r,n,o;return e="[data-name=account-form]",t={heading:u("Signup"),subheading:u("PleaseTellUsAboutYourself"),action1:u("Cancel"),action2:u("Submit")},a=t.heading,r=t.subheading,n=t.action1,o=t.action2,$(e+" h1.dialog").text(a),$(e+" h2.dialog").text(r),$(e+" [data-name=action1]").text(n),$(e+" [data-name=action2]").text(o),$(e)},accountCreated:function(){return i({heading:u("AccountCreatedSignup"),body:u("PleaseCheckEmailForVerificationLink",{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})},onShowLockedErrorAlert:function(e){var t=e.type;return i({heading:u("error"),body:u(t,{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})}};d.getName().trigger("focus");var m=d.setAccountSettings(),l=function(){Nogin.redirect("root")};d.getActionForAccountForm(m).on("click",l);var f=!1;if(Nogin.signupAgreement){var h=d.setConfirmSignup();c(h).on("click",(function(){f||(f=!0,g(),h.modal("hide"),m.trigger("submit"))})),d.getAccountForm().on("submit",(function(e){f||(e.preventDefault(),h.modal("show"))}))}else f=!0,g();function g(){var t,a,r,n,i,s,c,u,h,g=new o({signup:!0});t=m,r=(a={checkXSRF:!1,beforeSubmit:function(){return f},validate:function(){g.validateForm()},success:function(e,t){var a;"success"===t&&(a=d.accountCreated(),d.getAccountCreatedOkButton(a).on("click",(function(){setTimeout(l,3e3)})),a.modal("show"))},error:function(e){switch(e.responseText){case"email-taken":g.showInvalidEmail();break;case"username-taken":g.showInvalidUserName();break;default:d.onShowLockedErrorAlert({type:"DispatchActivationLinkError"}).modal("show")}}}).validate,n=a.url,i=a.beforeSubmit,s=a.success,c=a.error,u=a.checkXSRF,h=void 0===u||u,t[0].addEventListener("change",(function(e){r(e)}),!0),t[0].addEventListener("input",(function(e){var t=e.target;t.setCustomValidity(""),t.checkValidity()}),!0),!h||e||Nogin.disableXSRF?t.ajaxForm({headers:{"X-XSRF-Token":e},url:n,beforeSubmit:i,success:s,error:c}):c({responseText:"UnknownError"})}}();
//# sourceMappingURL=signupController.iife.min.js.map
