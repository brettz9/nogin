{"version":3,"file":"resetPasswordController.iife.min.js","sources":["../utilities/ajaxFormClientSideValidate.js","../views/reset-password.js","../views/validators/ResetPasswordValidatorView.js","../form-validators/ResetPasswordValidator.js","resetPasswordController.js"],"sourcesContent":["const ajaxFormClientSideValidate = (form, {\n  validate,\n  // `ajaxForm` properties and methods\n  url,\n  beforeSubmit,\n  success,\n  error\n}) => {\n  // As per problem #3 at https://www.html5rocks.com/en/tutorials/forms/constraintvalidation/#toc-current-implementation-issues ,\n  //  we can't do the validation at submit, so we instead add a capturing\n  //  change listener as well as input listeners to reset the messages;\n  //  note that we can't use the `invalid` event to call `reportValidity`\n  //  after our `setCustomValidity()` (to ensure we get the bubbles showing)\n  //  as that fires further `invalid` events; and setting the form to\n  //  `novalidate` won't show the bubbles.\n  form[0].addEventListener('change', (e) => {\n    // Provide custom messages of invalidity\n    validate(e);\n  }, true);\n\n  form[0].addEventListener('input', ({target: field}) => {\n    field.setCustomValidity('');\n    field.checkValidity('');\n  }, true);\n\n  return form.ajaxForm({\n    url,\n    beforeSubmit,\n    success,\n    error\n  });\n};\n\nexport default ajaxFormClientSideValidate;\n","/* globals $ */\n\nconst ResetPasswordView = {\n  /**\n   * @returns {external:jQuery} `HTMLFormElement`\n   */\n  getSetPasswordForm () {\n    return $('#set-password-form');\n  },\n\n  /**\n   * @returns {external:jQuery} `HTMLInputElement`\n   */\n  getPassword () {\n    return $('[data-name=\"reset-pass\"]');\n  },\n\n  /**\n   * @returns {external:jQuery} `HTMLButtonElement`\n   */\n  getSetPasswordSubmit () {\n    return $('[data-name=\"reset-password-submit\"]');\n  }\n};\n\nexport default ResetPasswordView;\n","/* globals $, _ */\n\nconst modal = $('#set-password');\nconst ResetPasswordValidatorView = {\n  /**\n   * @returns {external:jQuery} `HTMLDivElement`\n   */\n  setPasswordDialog () {\n    modal.modal({show: false, keyboard: false, backdrop: 'static'});\n    return modal;\n  },\n\n  /**\n   * @returns {external:jQuery} `HTMLDivElement`\n   */\n  getSetPasswordAlert () {\n    return modal.find('.alert');\n  },\n\n  /**\n   * @returns {void}\n   */\n  showSuccess () {\n    this.addAlert(_('YourPasswordHasBeenReset'));\n  },\n\n  addAlert (msg) {\n    this.getSetPasswordAlert().text(msg);\n  },\n\n  /**\n   * @returns {void}\n   */\n  showDanger () {\n    this.addAlert(_('SomethingWentWrongPleaseTryAgain'));\n  },\n\n  messages: {\n    ShouldBeMinimumLength: _('ShouldBeMinimumLength')\n  }\n};\n\nexport default ResetPasswordValidatorView;\n","import ResetPasswordValidatorView from\n  '../views/validators/ResetPasswordValidatorView.js';\n\n/**\n * Resetting password validation.\n */\nclass ResetPasswordValidator {\n  /**\n   * @param {external:jQuery} pass Password element\n   * @returns {boolean}\n   */\n  static validatePassword (pass) {\n    pass.setCustomValidity('');\n    // Todo[cypress@>4.3.0]: Remove this disabling of istanbul to see if fixed\n    //   see https://github.com/cypress-io/cypress/issues/6678\n    // istanbul ignore if\n    if (pass.validity.tooShort) {\n      pass.setCustomValidity(\n        ResetPasswordValidatorView.messages.ShouldBeMinimumLength\n      );\n    }\n    return pass.form.reportValidity();\n  }\n\n  /**\n   * Sets up properties.\n   */\n  constructor () {\n    this.modal = ResetPasswordValidatorView.setPasswordDialog();\n    this.alert = ResetPasswordValidatorView.getSetPasswordAlert();\n    this.alert.hide();\n  }\n\n  /**\n   * @returns {external:jQuery}\n   */\n  getPasswordDialog () {\n    return this.modal;\n  }\n\n  /**\n   * @returns {void}\n   */\n  showAlert () {\n    ResetPasswordValidatorView.showDanger();\n    this.alert.show();\n  }\n\n  /**\n   * @returns {void}\n   */\n  hideAlert () {\n    this.alert.hide();\n  }\n\n  /**\n   * @returns {void}\n   */\n  showSuccess () {\n    ResetPasswordValidatorView.showSuccess();\n    this.alert.fadeIn(500);\n  }\n}\n\nexport default ResetPasswordValidator;\n","/* globals NL_ROUTES */\n\nimport ajaxFormClientSideValidate from\n  '../utilities/ajaxFormClientSideValidate.js';\nimport ResetPasswordView from '../views/reset-password.js';\nimport ResetPasswordValidator from\n  '../form-validators/ResetPasswordValidator.js';\n\nconst rv = new ResetPasswordValidator();\n\nconst pass = ResetPasswordView.getPassword();\n\nconst setPasswordSubmit = ResetPasswordView.getSetPasswordSubmit();\n\nconst setPasswordForm = ResetPasswordView.getSetPasswordForm();\n\najaxFormClientSideValidate(\n  setPasswordForm,\n  {\n    validate () {\n      rv.hideAlert();\n      ResetPasswordValidator.validatePassword(pass[0]);\n    },\n    beforeSubmit (formData, jqForm, options) {\n      rv.hideAlert();\n    },\n    success (responseText, status, xhr, $form) {\n      setPasswordSubmit.addClass('disabled');\n      setPasswordSubmit.prop('disabled', true);\n      rv.showSuccess();\n      setTimeout(() => {\n        location.href = NL_ROUTES.root;\n      }, 3000);\n    },\n    error () {\n      rv.showAlert();\n    }\n  }\n);\n\nconst setPasswordDialog = rv.getPasswordDialog();\nsetPasswordDialog.on('shown.bs.modal', () => {\n  pass[0].focus();\n});\nsetPasswordDialog.modal('show');\n"],"names":["ResetPasswordView","$","form","validate","url","beforeSubmit","success","error","modal","ResetPasswordValidatorView","setPasswordDialog","show","keyboard","backdrop","getSetPasswordAlert","find","showSuccess","addAlert","_","msg","text","showDanger","messages","ShouldBeMinimumLength","ResetPasswordValidator","alert","hide","pass","setCustomValidity","validity","tooShort","reportValidity","this","fadeIn","rv","setPasswordSubmit","setPasswordForm","hideAlert","validatePassword","formData","jqForm","options","responseText","status","xhr","$form","addClass","prop","setTimeout","location","href","NL_ROUTES","root","showAlert","addEventListener","e","field","target","checkValidity","ajaxForm","getPasswordDialog","on","focus"],"mappings":"yBAAA,ICEMA,oBAKKC,EAAE,uBALPD,oBAYKC,EAAE,6BAZPD,oBAmBKC,EAAE,uQCnBb,IFFoCC,IAClCC,EAEAC,EACAC,EACAC,EACAC,EEJIC,EAAQP,EAAE,iBACVQ,EAA6B,CAIjCC,oCACEF,EAAMA,MAAM,CAACG,MAAM,EAAOC,UAAU,EAAOC,SAAU,WAC9CL,GAMTM,sCACSN,EAAMO,KAAK,WAMpBC,4BACOC,SAASC,EAAE,8BAGlBD,kBAAUE,QACHL,sBAAsBM,KAAKD,IAMlCE,2BACOJ,SAASC,EAAE,sCAGlBI,SAAU,CACRC,sBAAuBL,EAAE,2BChCvBM,qIAsBGhB,MAAQC,EAA2BC,yBACnCe,MAAQhB,EAA2BK,2BACnCW,MAAMC,+DAnBYC,UACvBA,EAAKC,kBAAkB,IAInBD,EAAKE,SAASC,UAChBH,EAAKC,kBACHnB,EAA2Ba,SAASC,uBAGjCI,EAAKzB,KAAK6B,2EAgBVC,KAAKxB,0CAOZC,EAA2BY,kBACtBI,MAAMd,gDAONc,MAAMC,6CAOXjB,EAA2BO,mBACtBS,MAAMQ,OAAO,cCpDhBC,EAAK,IAAIV,EAETG,EAAO3B,IAEPmC,EAAoBnC,IAEpBoC,EAAkBpC,IJdYE,EIiBlCkC,EJhBAjC,KIiBA,CACEA,oBACE+B,EAAGG,YACHb,EAAuBc,iBAAiBX,EAAK,KAE/CtB,sBAAckC,EAAUC,EAAQC,GAC9BP,EAAGG,aAEL/B,iBAASoC,EAAcC,EAAQC,EAAKC,GAClCV,EAAkBW,SAAS,YAC3BX,EAAkBY,KAAK,YAAY,GACnCb,EAAGlB,cACHgC,YAAW,WACTC,SAASC,KAAOC,UAAUC,OACzB,MAEL7C,iBACE2B,EAAGmB,eJlCPlD,SAEAC,IAAAA,IACAC,IAAAA,aACAC,IAAAA,QACAC,IAAAA,MASAL,EAAK,GAAGoD,iBAAiB,UAAU,SAACC,GAElCpD,EAASoD,MACR,GAEHrD,EAAK,GAAGoD,iBAAiB,SAAS,gBAAUE,IAARC,OAClCD,EAAM5B,kBAAkB,IACxB4B,EAAME,cAAc,OACnB,GAEIxD,EAAKyD,SAAS,CACnBvD,IAAAA,EACAC,aAAAA,EACAC,QAAAA,EACAC,MAAAA,IIWJ,IAAMG,EAAoBwB,EAAG0B,oBAC7BlD,EAAkBmD,GAAG,kBAAkB,WACrClC,EAAK,GAAGmC,WAEVpD,EAAkBF,MAAM"}