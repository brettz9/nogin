!function(){"use strict";function e(e,r,t){return Object.defineProperty(e,"prototype",{writable:!1}),e}"undefined"==typeof Error&&(window.Error=e((function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e)})));var r=function(e){var r=e.type,t=e.header,o=e.body,n=e.cancel,a=e.submit,u='[data-confirm-type="'.concat(r,'"][data-name=modal-confirm]');return $(u).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(u," .modal-header [data-name=modal-title]")).text(t),$("".concat(u," [data-name=modal-body] p")).empty().append(o),$("".concat(u," .cancel")).text(n).on("click",(function(){$(u).modal("hide")})),$("".concat(u," .submit")).text(a),$(u)},t=function(e){return e.find(".submit")},o=function(e){var r=e.heading,t=e.body,o=e.keyboard,n=e.backdrop,a=$("[data-name=modal-alert]").modal({show:!1,keyboard:o,backdrop:n});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(r),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(t),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),a.modal("hide")})),a},n=Nogin._;function a(e){var r=e.type,t=e.message,a=e.group,u=e.heading;return o({heading:n(u),body:t||n(r,a?{lb:$("<br/>")[0],group:a}:{},{throwOnExtraSuppliedFormatters:!1}),keyboard:!1,backdrop:"static"})}var u={getLockedAlertButton:function(e){return e.find("button")},getDeleteGroups:function(){return $("button.deleteGroup")},getRemoveUserFromGroup:function(){return $("button.removeUserFromGroup")},createGroupModal:function(){var e=$("#createGroup");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},renameGroupModal:function(){var e=$("#renameGroup");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},addUserToGroupModal:function(){var e=$("#addUserToGroup");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},createGroupForm:function(e){return e.find("#createGroup-form")},renameGroupForm:function(e){return e.find("#renameGroup-form")},addUserToGroupForm:function(e){return e.find("#addUserToGroup-form")},createGroupSubmit:function(e){return e.find("[data-name=createGroup-submit]")},addUserToGroupSubmit:function(e){return e.find("[data-name=addUserToGroup-submit]")},renameGroupSubmit:function(e){return e.find("[data-name=renameGroup-submit]")},createGroupCancel:function(e){return e.find("[data-name=createGroup-cancel]")},addUserToGroupCancel:function(e){return e.find("[data-name=addUserToGroup-cancel]")},renameGroupCancel:function(e){return e.find("[data-name=renameGroup-cancel]")},getCreateGroupButton:function(){return $("button.createGroup")},getRenameGroupButton:function(){return $("button.renameGroup")},getAddUserToGroupButton:function(){return $("button.addUserToGroup")},getCreateGroupName:function(){return $("#createGroup-input")[0]},getAddUserToGroupName:function(){return $("#addUserToGroup-input")[0]},getRenameGroupName:function(){return $("#renameGroup-input")[0]},setDeleteGroup:function(e){var t=r({type:"deleteGroup",header:n("deleteGroup"),body:n("sureWantDeleteGroup",{group:e}),cancel:n("cancel"),submit:n("delete")});return t.find(".submit").addClass("btn-danger"),t},setRemoveUserFromGroup:function(){var e=r({type:"deleteGroup",header:n("removeUserFromGroup"),body:n("reallyWantRemoveUserFromGroup"),cancel:n("cancel"),submit:n("delete")});return e.find(".submit").addClass("btn-danger"),e},onShowLockedAlert:function(e){return a({type:e.type,group:e.group,heading:"success"})},onShowLockedErrorAlert:function(e){var r=e.type,t=e.group;return a({type:r,message:e.message,group:t,heading:"error"})},errorMessages:{name:{PleaseEnterName:n("PleaseEnterName")}}};function c(){}var i=l((function(){return F.modal("hide"),y(R(Nogin.Routes.accessAPI,{verb:"deleteGroup",groupName:w}),(function(){S({type:"groupDeleted"})}))}));function d(e,r){return e&&e.then?e.then(c):Promise.resolve()}var s=l((function(e,r){return y(R(Nogin.Routes.accessAPI,{verb:"addUserToGroup",groupName:e,userID:r}),(function(){A.modal("hide"),S({type:"userAddedToGroup"})}))}));function m(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var p=l((function(e,r){return y(R(Nogin.Routes.accessAPI,{verb:"renameGroup",groupName:e,newGroupName:r}),(function(){N.modal("hide"),S({type:"groupRenamed"})}))}));function l(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}var f=l((function(e){return y(R(Nogin.Routes.accessAPI,{verb:"createGroup",groupName:e}),(function(){k.modal("hide"),S({type:"groupCreated"})}))}));var g=l((function(e,r){return E.modal("hide"),y(R(Nogin.Routes.accessAPI,{verb:"removeUserFromGroup",groupName:e,userID:r}),(function(){S({type:"userRemovedFromGroup"})}))}));function G(e,r){return function(e,r,t){try{var o=Promise.resolve(e());return r?o.then(r):o}catch(e){return Promise.reject(e)}}(e,c)}var v=$('meta[name="csrf-token"]').attr("content");function h(e){if(e&&e.then)return e.then(c)}var b=u.getCreateGroupButton();function y(e,r,t){return e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e}var k=u.createGroupModal(),T=u.createGroupForm(k);T.on("submit",(function(e){e.preventDefault()})),b.on("click",(function(){u.createGroupCancel(k).on("click",(function(){k.modal("hide")})),k.modal("show"),u.createGroupSubmit(k).on("click",l((function(){return m((function(){var e=u.getCreateGroupName();return e.validity.tooShort?(e.setCustomValidity(u.errorMessages.name.PleaseEnterName),void T[0].reportValidity()):d(f(e.value))}),(function(e){k.modal("hide");var r=e;console.error(Nogin._("ErrorFormat",{text:r.text,statusText:r.statusText||""})),D({message:r.text})}))})))}));var x=u.getRenameGroupButton(),N=u.renameGroupModal(),U=u.renameGroupForm(N);U.on("submit",(function(e){e.preventDefault()})),x.on("click",(function(e){var r=e.target.dataset.group,t=u.getRenameGroupName();u.renameGroupCancel(N).on("click",(function(){N.modal("hide")})),N.modal("show"),t.value=r,u.renameGroupSubmit(N).on("click",l((function(){return m((function(){if(t.validity.tooShort)return t.setCustomValidity(u.errorMessages.name.PleaseEnterName),void U[0].reportValidity();var e=t.value;return d(p(r,e))}),(function(e){N.modal("hide");var r=e;console.error(Nogin._("ErrorFormat",{text:r.text,statusText:r.statusText||""})),D({message:r.text})}))})))}));var w,F,P=u.getAddUserToGroupButton(),A=u.addUserToGroupModal(),C=u.addUserToGroupForm(A);C.on("submit",(function(e){e.preventDefault()})),P.on("click",(function(e){var r=e.target.dataset.group,t=u.getAddUserToGroupName();u.addUserToGroupCancel(A).on("click",(function(){A.modal("hide")})),A.modal("show"),u.addUserToGroupSubmit(A).on("click",l((function(){return m((function(){if(t.validity.tooShort)return t.setCustomValidity(u.errorMessages.name.PleaseEnterName),void C[0].reportValidity();var e=t.value;return d(s(r,e))}),(function(e){A.modal("hide");var r=e;console.error(Nogin._("ErrorFormat",{text:r.text,statusText:r.statusText||""})),D({message:r.text})}))})))})),u.getDeleteGroups().on("click",(function(e){w=e.target.dataset.group,F=u.setDeleteGroup(w),t(F).on("click",l((function(){return h(m((function(){return G(i)}),(function(e){var r=e;console.error(Nogin._("ErrorFormat",{text:r.text,statusText:r.statusText||""})),D({message:r.text})})))}))),F.modal("show")}));var E=u.setRemoveUserFromGroup();function R(e,r){var t={type:"post",headers:{"X-XSRF-Token":v}};return r&&(t.data=r),new Promise((function(r,o){$.ajax(e,t).done(r).fail((function(e){var r=new Error("Ajax POST error");r.text=e.responseText,r.responseText=e.statusText,o(r)}))}))}function S(e){var r=e.type,t=u.onShowLockedAlert({type:r,group:w});t.modal("show");var o=function(){location.reload(!0)};u.getLockedAlertButton(t).on("click",o),setTimeout(o,3e3)}function D(e){var r=e.type,t=e.message,o=u.onShowLockedErrorAlert({type:r,message:t,group:w});o.modal("show");var n=function(){location.reload(!0)};u.getLockedAlertButton(o).on("click",n),setTimeout(n,3e3)}u.getRemoveUserFromGroup().on("click",(function(e){var r=e.target.dataset.group,o=e.target.dataset.user;t(E).on("click",l((function(){return h(m((function(){return d(g(r,o))}),(function(e){var r=e;console.error(Nogin._("ErrorFormat",{text:r.text,statusText:r.statusText||""})),D({message:r.text})})))}))),E.modal("show")}))}();
//# sourceMappingURL=groupsController.iife.min.js.map
