!function(){"use strict";var e=function(e){var t=e.type,a=e.header,n=e.body,r=e.cancel,o=e.submit,s='[data-confirm-type="'.concat(t,'"][data-name=modal-confirm]');return $(s).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(s," .modal-header [data-name=modal-title]")).text(a),$("".concat(s," [data-name=modal-body] p")).empty().append(n),$("".concat(s," .cancel")).text(r),$("".concat(s," .submit")).text(o),$(s)},t=function(e){return e.find(".submit")},a=function(e){var t=e.heading,a=e.body,n=e.keyboard,r=e.backdrop;return $("[data-name=modal-alert]").modal({show:!1,keyboard:n,backdrop:r}),$("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(a),$("[data-name=modal-alert]")};function n(e){var t=e.type,n=e.message,r=e.heading;return a({heading:_(r),body:n||_(t,{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})}var r=function(){return $("[data-name=btn-logout]")},o=function(){return $('[data-name="name"]')},s=function(){return $('[data-name="email"]')},i=function(e){return e.find("[data-name=action1]")},u=function(e){return e.find("button")},c=function(e){return e.find("button")},d=function(){return $('[data-name="user"]')},l=function(t){var a=t.type;return e({type:"notice",header:_("notice"),body:_(a,{lb:$("<br/>")[0]}),cancel:_("cancel"),submit:_("confirm")})},m=function(){var t=e({type:"deleteAccount",header:_("deleteAccount"),body:_("sureWantDeleteAccount"),cancel:_("cancel"),submit:_("delete")});return t.find(".submit").addClass("btn-danger"),t},f=function(){var e,t,a,n,r,o,s=(e="[data-name=account-form]",t={heading:_("accountSettings"),subheading:_("hereAreCurrentSettings"),action1:_("deleteText"),action2:_("updateText")},a=t.heading,n=t.subheading,r=t.action1,o=t.action2,$(e+" h1.dialog").text(a),$(e+" h2.dialog").text(n),$(e+" [data-name=action1]").text(r),$(e+" [data-name=action2]").text(o),$(e));return s.find("[data-name=action1]").removeClass("btn-outline-dark").addClass("btn-danger"),s},h=function(){return a({heading:_("success"),body:_("yourAccountHasBeenUpdated"),keyboard:!0,backdrop:!0})},p=function(){return a({heading:_("success"),body:_("yourAccountHasBeenUpdatedButEmail"),keyboard:!0,backdrop:!0})},y=function(e){return n({type:e.type,heading:"success"})},g=function(e){return n({type:e.type,message:e.message,heading:"error"})};function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var k={getForm:function(){return $("[data-name=account-form]")[0]},getUserId:function(){return $("#userId")},getFormFields:function(){return{name:$('[data-name="name"]')[0],email:$('[data-name="email"]')[0],user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0],passConfirm:$('[data-name="pass-confirm"]')&&$('[data-name="pass-confirm"]')[0]}},errorMessages:{name:{PleaseEnterName:_("PleaseEnterName")},email:{emailAddressAlreadyInUse:_("emailAddressAlreadyInUse"),PleaseEnterValidEmail:_("PleaseEnterValidEmail")},user:{userNameAlreadyInUse:_("userNameAlreadyInUse"),PleaseChooseUserName:_("PleaseChooseUserName")},pass:{PasswordMinimumLength:_("PasswordMinimumLength"),PasswordsDontMatch:_("PasswordsDontMatch")}}},x=function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.signup;v(this,e),this.signup=n,this.form=k.getForm(),this.formFields=k.getFormFields(),this.userId=k.getUserId(),this.errorMessages=k.errorMessages,this.userIsLoggedIn=function(e){return t.userId.val()&&""===e}}var t,a,n;return t=e,(a=[{key:"showInvalidEmail",value:function(){this.formFields.email.setCustomValidity(this.errorMessages.email.emailAddressAlreadyInUse),this.form.reportValidity()}},{key:"showInvalidUserName",value:function(){this.formFields.user.setCustomValidity(this.errorMessages.user.userNameAlreadyInUse),this.form.reportValidity()}},{key:"validateForm",value:function(){var e=this.formFields,t=e.name,a=e.email,n=e.user,r=e.pass,o=e.passConfirm;return Object.values(this.formFields).forEach((function(e){e&&e.setCustomValidity("")})),t.validity.tooShort&&t.setCustomValidity(this.errorMessages.name.PleaseEnterName),a.validity.patternMismatch&&a.setCustomValidity(this.errorMessages.email.PleaseEnterValidEmail),n.validity.tooShort&&n.setCustomValidity(this.errorMessages.user.PleaseChooseUserName),!this.userIsLoggedIn()&&r.validity.tooShort&&r.setCustomValidity(this.errorMessages.pass.PasswordMinimumLength),this.signup&&r.value!==o.value&&r.setCustomValidity(this.errorMessages.pass.PasswordsDontMatch),this.form.reportValidity()}}])&&b(t.prototype,a),n&&b(t,n),e}();function E(){}function P(e,t,a){return a?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var w=M((function(){return P(q(NL_ROUTES.logout),(function(){z({type:"loggedOut"})}))})),C=M((function(){return V.modal("hide"),P(q(NL_ROUTES.delete),(function(){z({type:"accountDeleted"})}))}));function I(e,t){return function(e,t,a){if(a)return t?t(e()):e();try{var n=Promise.resolve(e());return t?n.then(t):n}catch(e){return Promise.reject(e)}}(e,E,t)}function U(e,t){try{var a=e()}catch(e){return t(e)}return a&&a.then?a.then(void 0,t):a}function F(e){if(e&&e.then)return e.then(E)}function M(e){return function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}o().focus();var T=d();T.attr("disabled","disabled");var V=m();t(V).click(M((function(){return F(U((function(){return I(C)}),(function(e){console.error(_("ErrorFormat",{text:e.text,statusText:e.statusText||""})),G({message:e.text})})))}))),r().click(M((function(){return F(U((function(){return I(w)}),(function(e){console.error(_("ErrorFormat",{text:e.text,statusText:e.statusText||""})),G({type:"ErrorLoggingOut"})})))})));var A,L,N,S,O,D,j,R,B,H=f();function W(){var e=s();return e[0].value!==e[0].defaultValue}function q(e){return new Promise((function(t,a){$.ajax(e,{type:"post"}).done(t).fail((function(e){var t=new Error;t.text=e.responseText,t.responseText=e.statusText,a(t)}))}))}function z(e){var t=e.type,a=y({type:t});a.modal("show");var n=function(){location.href=NL_ROUTES.root};u(a).click(n),setTimeout(n,3e3)}function G(e){var t=e.type,a=e.message,n=g({type:t,message:a});n.modal("show");var r=function(){location.href=NL_ROUTES.root};u(n).click(r),setTimeout(r,3e3)}i(H).click((function(){V.modal("show")})),A=!1,L=new x,H[0].addEventListener("submit",(function(e){if(!A&&W()){e.preventDefault(),e.stopPropagation();var a=l({type:"AppearsChangingEmail"});a.modal("show"),t(a).click((function(){A=!0,H.submit(),a.modal("hide")}))}}),!0),N=H,O=(S={validate:function(){L.validateForm()},beforeSubmit:function(e,t,a){return e.push({name:"user",value:T.val()}),!0},success:function(e,t,a,n){var r;"success"===t&&((r=W()?p():h()).modal("show"),c(r).off("click")),A=!1},error:function(e){switch(A=!1,e.responseText){case"email-taken":L.showInvalidEmail();break;case"session-lost":G({type:"SessionLost"});break;case"problem-dispatching-link":G({type:"ProblemDispatchingLink"});break;default:g({type:"FailureSubmittingUserInfo"})}}}).validate,D=S.url,j=S.beforeSubmit,R=S.success,B=S.error,N[0].addEventListener("change",(function(e){O(e)}),!0),N[0].addEventListener("input",(function(e){var t=e.target;t.setCustomValidity(""),t.checkValidity("")}),!0),N.ajaxForm({url:D,beforeSubmit:j,success:R,error:B})}();
//# sourceMappingURL=homeController.iife.min.js.map
