!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t,a){return t&&function(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}"undefined"==typeof Error&&(window.Error=t((function t(){e(this,t)})));var a=$('meta[name="csrf-token"]').attr("content"),r=function(e){var t=e.type,n=e.header,a=e.body,r=e.cancel,o=e.submit,i='[data-confirm-type="'.concat(t,'"][data-name=modal-confirm]');return $(i).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(i," .modal-header [data-name=modal-title]")).text(n),$("".concat(i," [data-name=modal-body] p")).empty().append(a),$("".concat(i," .cancel")).text(r).on("click",(function(){$(i).modal("hide")})),$("".concat(i," .submit")).text(o),$(i)},o=function(e){return e.find(".submit")},i=function(e){var t=e.heading,n=e.body,a=e.keyboard,r=e.backdrop,o=$("[data-name=modal-alert]").modal({show:!1,keyboard:a,backdrop:r});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(n),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),o.modal("hide")})),o},s=Nogin._;function u(e){var t=e.type,n=e.message,a=e.heading;return i({heading:s(a),body:n||s(t,{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})}var c={getLogoutButton:function(){return $("[data-name=btn-logout]")},getName:function(){return $('[data-name="name"]')},getEmail:function(){return $('[data-name="email"]')},getDeleteAccountAction:function(e){return e.find("[data-name=action1]")},getLockedAlertButton:function(e){return e.find("button")},getAccountUpdatedButton:function(e){return e.find("button")},getUser:function(){return $('[data-name="user"]')},onShowConfirmation:function(e){var t=e.type;return r({type:"notice",header:s("notice"),body:s(t,{lb:$("<br/>")[0]}),cancel:s("cancel"),submit:s("confirm")})},setDeleteAccount:function(){var e=r({type:"deleteAccount",header:s("deleteAccount"),body:s("sureWantDeleteAccount"),cancel:s("cancel"),submit:s("delete")});return e.find(".submit").addClass("btn-danger"),e},setAccountSettings:function(){var e,t,n,a,r,o,i=(e="[data-name=account-form]",t={heading:s("accountSettings"),subheading:s("hereAreCurrentSettings"),action1:s("deleteText"),action2:s("updateText")},n=t.heading,a=t.subheading,r=t.action1,o=t.action2,$(e+" h1.dialog").text(n),$(e+" h2.dialog").text(a),$(e+" [data-name=action1]").text(r),$(e+" [data-name=action2]").text(o),$(e));return i.find("[data-name=action1]").removeClass("btn-outline-dark").addClass("btn-danger"),i},onAccountUpdated:function(){return i({heading:s("success"),body:s("yourAccountHasBeenUpdated"),keyboard:!0,backdrop:!0})},onAccountUpdatedButNotYetEmail:function(){return i({heading:s("success"),body:s("yourAccountHasBeenUpdatedButEmail"),keyboard:!0,backdrop:!0})},onShowLockedAlert:function(e){return u({type:e.type,heading:"success"})},onShowLockedErrorAlert:function(e){return u({type:e.type,message:e.message,heading:"error"})}},d=Nogin._,l={getForm:function(){return $("[data-name=account-form]")[0]},getUserId:function(){return $("#userId")},getFormFields:function(){return{name:$('[data-name="name"]')[0],email:$('[data-name="email"]')[0],user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0],passConfirm:$('[data-name="pass-confirm"]')&&$('[data-name="pass-confirm"]')[0]}},errorMessages:{name:{PleaseEnterName:d("PleaseEnterName")},email:{emailAddressAlreadyInUse:d("emailAddressAlreadyInUse"),PleaseEnterValidEmail:d("PleaseEnterValidEmail")},user:{userNameAlreadyInUse:d("userNameAlreadyInUse"),PleaseChooseUserName:d("PleaseChooseUserName")},pass:{PasswordMinimumLength:d("PasswordMinimumLength"),PasswordsDontMatch:d("PasswordsDontMatch")}}},m=function(){return t((function t(){var n=this,a=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).signup;e(this,t),this.signup=a,this.form=l.getForm(),this.formFields=l.getFormFields(),this.userId=l.getUserId(),this.errorMessages=l.errorMessages,this.userIsLoggedIn=function(e){return Boolean(n.userId.val())&&""===e}}),[{key:"showInvalidEmail",value:function(){this.formFields.email.setCustomValidity(this.errorMessages.email.emailAddressAlreadyInUse),this.form.reportValidity()}},{key:"showInvalidUserName",value:function(){this.formFields.user.setCustomValidity(this.errorMessages.user.userNameAlreadyInUse),this.form.reportValidity()}},{key:"validateForm",value:function(){var e=this.formFields,t=e.name,n=e.email,a=e.user,r=e.pass,o=e.passConfirm;return Object.values(this.formFields).forEach((function(e){e&&e.setCustomValidity("")})),t.validity.tooShort&&t.setCustomValidity(this.errorMessages.name.PleaseEnterName),n.validity.patternMismatch&&n.setCustomValidity(this.errorMessages.email.PleaseEnterValidEmail),a.validity.tooShort&&a.setCustomValidity(this.errorMessages.user.PleaseChooseUserName),!this.userIsLoggedIn(r.value)&&r.validity.tooShort&&r.setCustomValidity(this.errorMessages.pass.PasswordMinimumLength),this.signup&&r.value!==o.value&&r.setCustomValidity(this.errorMessages.pass.PasswordsDontMatch),this.form.reportValidity()}}])}();function f(){}var h=k((function(){return A(D(Nogin.Routes.logout),(function(){j({type:"loggedOut"})}))}));var g=k((function(){return E.modal("hide"),A(D(Nogin.Routes.delete),(function(){j({type:"accountDeleted"})}))}));function p(e,t){return function(e,t,n){try{var a=Promise.resolve(e());return t?a.then(t):a}catch(e){return Promise.reject(e)}}(e,f)}var y=$('meta[name="csrf-token"]').attr("content");function v(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function b(e){if(e&&e.then)return e.then(f)}function k(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function A(e,t,n){return e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e}c.getName().focus();var w=c.getUser();w.attr("disabled","disabled");var E=c.setDeleteAccount();o(E).on("click",k((function(){return b(v((function(){return p(g)}),(function(e){var t=e;console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),O({message:t.text})})))}))),c.getLogoutButton().on("click",k((function(){return b(v((function(){return p(h)}),(function(e){var t=e;console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),O({type:"ErrorLoggingOut"})})))})));var x,P,S,N,U,C,F,L,I,T,M,V=c.setAccountSettings();function B(){var e=c.getEmail()[0];return e.value!==e.defaultValue}function D(e){return new Promise((function(t,n){$.ajax(e,{type:"post",headers:{"X-XSRF-Token":y}}).done(t).fail((function(e){var t=new Error("Ajax POST error");t.text=e.responseText,t.responseText=e.statusText,n(t)}))}))}function j(e){var t=e.type,n=c.onShowLockedAlert({type:t});n.modal("show");var a=function(){Nogin.redirect("root")};c.getLockedAlertButton(n).on("click",a),setTimeout(a,3e3)}function O(e){var t=e.type,n=e.message,a=c.onShowLockedErrorAlert({type:t,message:n});a.modal("show");var r=function(){Nogin.redirect("root")};c.getLockedAlertButton(a).on("click",r),setTimeout(r,3e3)}c.getDeleteAccountAction(V).on("click",(function(){E.modal("show")})),x=!1,P=new m,V[0].addEventListener("submit",(function(e){if(!x&&B()){e.preventDefault(),e.stopPropagation();var t=c.onShowConfirmation({type:"AppearsChangingEmail"});t.modal("show"),o(t).on("click",(function(){x=!0,V.submit(),t.modal("hide")}))}}),!0),S=V,U=(N={validate:function(){P.validateForm()},beforeSubmit:function(e){return e.push({name:"user",value:w.val()}),!0},success:function(e,t){"success"===t&&(B()?c.onAccountUpdatedButNotYetEmail():c.onAccountUpdated()).modal("show"),x=!1},error:function(e){switch(x=!1,e.responseText){case"email-taken":P.showInvalidEmail();break;case"session-lost":O({type:"SessionLost"});break;case"problem-dispatching-link":O({type:"ProblemDispatchingLink"});break;default:c.onShowLockedErrorAlert({type:"FailureSubmittingUserInfo"})}}}).validate,C=N.url,F=N.beforeSubmit,L=N.success,I=N.error,T=N.checkXSRF,M=void 0===T||T,S[0].addEventListener("change",(function(e){U(e)}),!0),S[0].addEventListener("input",(function(e){var t=e.target;t.setCustomValidity(""),t.checkValidity()}),!0),!M||a||Nogin.disableXSRF?S.ajaxForm({headers:{"X-XSRF-Token":a},url:C,beforeSubmit:F,success:L,error:I}):I({responseText:"UnknownError"})}();
//# sourceMappingURL=homeController.iife.min.js.map
