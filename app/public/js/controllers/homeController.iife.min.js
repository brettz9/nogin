!function(){"use strict";function e(e,t,a,n,r,s,o){try{var i=e[s](o),u=i.value}catch(e){return void a(e)}i.done?t(u):Promise.resolve(u).then(n,r)}function t(t){return function(){var a=this,n=arguments;return new Promise((function(r,s){var o=t.apply(a,n);function i(t){e(o,r,s,i,u,"next",t)}function u(t){e(o,r,s,i,u,"throw",t)}i(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e){var t=e.type,a=e.header,n=e.body,r=e.cancel,s=e.submit,o='[data-confirm-type="'.concat(t,'"][data-name=modal-confirm]');return $(o).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(o," .modal-header [data-name=modal-title]")).text(a),$("".concat(o," [data-name=modal-body] p")).empty().append(n),$("".concat(o," .cancel")).text(r),$("".concat(o," .submit")).text(s),$(o)},s=function(e){return e.find(".submit")},o=function(e){var t=e.heading,a=e.body,n=e.keyboard,r=e.backdrop;return $("[data-name=modal-alert]").modal({show:!1,keyboard:n,backdrop:r}),$("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(a),$("[data-name=modal-alert]")};function i(e){var t=e.type,a=e.message,n=e.heading;return o({heading:_(n),body:a||_(t,{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})}var u=function(){return $("[data-name=btn-logout]")},c=function(){return $('[data-name="name"]')},d=function(){return $('[data-name="email"]')},l=function(e){return e.find("[data-name=action1]")},m=function(e){return e.find("button")},f=function(e){return e.find("button")},p=function(){return $('[data-name="user"]')},h=function(e){var t=e.type;return r({type:"notice",header:_("notice"),body:_(t,{lb:$("<br/>")[0]}),cancel:_("cancel"),submit:_("confirm")})},y=function(){var e=r({type:"deleteAccount",header:_("deleteAccount"),body:_("sureWantDeleteAccount"),cancel:_("cancel"),submit:_("delete")});return e.find(".submit").addClass("btn-danger"),e},g=function(){var e,t,a,n,r,s,o=(e="[data-name=account-form]",t={heading:_("accountSettings"),subheading:_("hereAreCurrentSettings"),action1:_("deleteText"),action2:_("updateText")},a=t.heading,n=t.subheading,r=t.action1,s=t.action2,$(e+" h1.dialog").text(a),$(e+" h2.dialog").text(n),$(e+" [data-name=action1]").text(r),$(e+" [data-name=action2]").text(s),$(e));return o.find("[data-name=action1]").removeClass("btn-outline-dark").addClass("btn-danger"),o},v=function(){return o({heading:_("success"),body:_("yourAccountHasBeenUpdated"),keyboard:!0,backdrop:!0})},b=function(){return o({heading:_("success"),body:_("yourAccountHasBeenUpdatedButEmail"),keyboard:!0,backdrop:!0})},k=function(e){return i({type:e.type,heading:"success"})},x=function(e){return i({type:e.type,message:e.message,heading:"error"})},w={getForm:function(){return $("[data-name=account-form]")[0]},getUserId:function(){return $("#userId")},getFormFields:function(){return{name:$('[data-name="name"]')[0],email:$('[data-name="email"]')[0],user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0],passConfirm:$('[data-name="pass-confirm"]')&&$('[data-name="pass-confirm"]')[0]}},errorMessages:{name:{PleaseEnterName:_("PleaseEnterName")},email:{emailAddressAlreadyInUse:_("emailAddressAlreadyInUse"),PleaseEnterValidEmail:_("PleaseEnterValidEmail")},user:{userNameAlreadyInUse:_("userNameAlreadyInUse"),PleaseChooseUserName:_("PleaseChooseUserName")},pass:{PasswordMinimumLength:_("PasswordMinimumLength"),PasswordsDontMatch:_("PasswordsDontMatch")}}},E=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.signup;a(this,e),this.signup=r,this.form=w.getForm(),this.formFields=w.getFormFields(),this.userId=w.getUserId(),this.errorMessages=w.errorMessages,this.userIsLoggedIn=function(e){return t.userId.val()&&""===e}}var t,r,s;return t=e,(r=[{key:"showInvalidEmail",value:function(){this.formFields.email.setCustomValidity(this.errorMessages.email.emailAddressAlreadyInUse),this.form.reportValidity()}},{key:"showInvalidUserName",value:function(){this.formFields.user.setCustomValidity(this.errorMessages.user.userNameAlreadyInUse),this.form.reportValidity()}},{key:"validateForm",value:function(){var e=this.formFields,t=e.name,a=e.email,n=e.user,r=e.pass,s=e.passConfirm;return Object.values(this.formFields).forEach((function(e){e&&e.setCustomValidity("")})),t.validity.tooShort&&t.setCustomValidity(this.errorMessages.name.PleaseEnterName),a.validity.patternMismatch&&a.setCustomValidity(this.errorMessages.email.PleaseEnterValidEmail),n.validity.tooShort&&n.setCustomValidity(this.errorMessages.user.PleaseChooseUserName),!this.userIsLoggedIn()&&r.validity.tooShort&&r.setCustomValidity(this.errorMessages.pass.PasswordMinimumLength),this.signup&&r.value!==s.value&&r.setCustomValidity(this.errorMessages.pass.PasswordsDontMatch),this.form.reportValidity()}}])&&n(t.prototype,r),s&&n(t,s),e}();c().focus();var P=p();P.attr("disabled","disabled");var C=y();s(C).click(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(_("ErrorFormat",{text:e.t0.text,statusText:e.t0.statusText||""})),q({message:e.t0.text});case 9:case"end":return e.stop()}}),e,null,[[0,5]])})))),u().click(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(_("ErrorFormat",{text:e.t0.text,statusText:e.t0.statusText||""})),q({type:"ErrorLoggingOut"});case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))));var I,U,F,M,T,V,A,L,N,S=g();function R(){var e=d();return e[0].value!==e[0].defaultValue}function O(e){return new Promise((function(t,a){$.ajax(e,{type:"post"}).done(t).fail((function(e){var t=new Error;t.text=e.responseText,t.responseText=e.statusText,a(t)}))}))}function D(){return j.apply(this,arguments)}function j(){return(j=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.modal("hide"),e.next=3,O(NL_ROUTES.delete);case 3:W({type:"accountDeleted"});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return H.apply(this,arguments)}function H(){return(H=t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(NL_ROUTES.logout);case 2:W({type:"loggedOut"});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){var t=e.type,a=k({type:t});a.modal("show");var n=function(){location.href=NL_ROUTES.root};m(a).click(n),setTimeout(n,3e3)}function q(e){var t=e.type,a=e.message,n=x({type:t,message:a});n.modal("show");var r=function(){location.href=NL_ROUTES.root};m(n).click(r),setTimeout(r,3e3)}l(S).click((function(){C.modal("show")})),I=!1,U=new E,S[0].addEventListener("submit",(function(e){if(!I&&R()){e.preventDefault(),e.stopPropagation();var t=h({type:"AppearsChangingEmail"});t.modal("show"),s(t).click((function(){I=!0,S.submit(),t.modal("hide")}))}}),!0),F=S,T=(M={validate:function(){U.validateForm()},beforeSubmit:function(e,t,a){return e.push({name:"user",value:P.val()}),!0},success:function(e,t,a,n){var r;"success"===t&&((r=R()?b():v()).modal("show"),f(r).off("click")),I=!1},error:function(e){switch(I=!1,e.responseText){case"email-taken":U.showInvalidEmail();break;case"session-lost":q({type:"SessionLost"});break;case"problem-dispatching-link":q({type:"ProblemDispatchingLink"});break;default:x({type:"FailureSubmittingUserInfo"})}}}).validate,V=M.url,A=M.beforeSubmit,L=M.success,N=M.error,F[0].addEventListener("change",(function(e){T(e)}),!0),F[0].addEventListener("input",(function(e){var t=e.target;t.setCustomValidity(""),t.checkValidity("")}),!0),F.ajaxForm({url:V,beforeSubmit:A,success:L,error:N})}();
//# sourceMappingURL=homeController.iife.min.js.map
