!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}"undefined"==typeof Error&&(window.Error=function t(){e(this,t)});var n="undefined"==typeof console?{}:console,a=function(){};["error","log"].forEach((function(e){n[e]||(n[e]=a)}));var r=$('meta[name="csrf-token"]').attr("content"),o=function(e){var t=e.type,n=e.header,a=e.body,r=e.cancel,o=e.submit,s='[data-confirm-type="'.concat(t,'"][data-name=modal-confirm]');return $(s).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(s," .modal-header [data-name=modal-title]")).text(n),$("".concat(s," [data-name=modal-body] p")).empty().append(a),$("".concat(s," .cancel")).text(r).click((function(){$(s).modal("hide")})),$("".concat(s," .submit")).text(o),$(s)},s=function(e){return e.find(".submit")},i=function(e){var t=e.heading,n=e.body,a=e.keyboard,r=e.backdrop,o=$("[data-name=modal-alert]").modal({show:!1,keyboard:a,backdrop:r});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(n),$("[data-name=modal-alert] button").click((function(e){e.preventDefault(),o.modal("hide")})),o},u=Nogin._;function c(e){var t=e.type,n=e.message,a=e.heading;return i({heading:u(a),body:n||u(t,{lb:$("<br/>")[0]}),keyboard:!1,backdrop:"static"})}var d=function(){return $("[data-name=btn-logout]")},l=function(){return $('[data-name="name"]')},m=function(){return $('[data-name="email"]')},f=function(e){return e.find("[data-name=action1]")},h=function(e){return e.find("button")},p=function(){return $('[data-name="user"]')},g=function(e){var t=e.type;return o({type:"notice",header:u("notice"),body:u(t,{lb:$("<br/>")[0]}),cancel:u("cancel"),submit:u("confirm")})},y=function(){var e=o({type:"deleteAccount",header:u("deleteAccount"),body:u("sureWantDeleteAccount"),cancel:u("cancel"),submit:u("delete")});return e.find(".submit").addClass("btn-danger"),e},v=function(){var e,t,n,a,r,o,s=(e="[data-name=account-form]",t={heading:u("accountSettings"),subheading:u("hereAreCurrentSettings"),action1:u("deleteText"),action2:u("updateText")},n=t.heading,a=t.subheading,r=t.action1,o=t.action2,$(e+" h1.dialog").text(n),$(e+" h2.dialog").text(a),$(e+" [data-name=action1]").text(r),$(e+" [data-name=action2]").text(o),$(e));return s.find("[data-name=action1]").removeClass("btn-outline-dark").addClass("btn-danger"),s},b=function(){return i({heading:u("success"),body:u("yourAccountHasBeenUpdated"),keyboard:!0,backdrop:!0})},k=function(){return i({heading:u("success"),body:u("yourAccountHasBeenUpdatedButEmail"),keyboard:!0,backdrop:!0})},x=function(e){return c({type:e.type,heading:"success"})},w=function(e){return c({type:e.type,message:e.message,heading:"error"})},E=Nogin._,P={getForm:function(){return $("[data-name=account-form]")[0]},getUserId:function(){return $("#userId")},getFormFields:function(){return{name:$('[data-name="name"]')[0],email:$('[data-name="email"]')[0],user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0],passConfirm:$('[data-name="pass-confirm"]')&&$('[data-name="pass-confirm"]')[0]}},errorMessages:{name:{PleaseEnterName:E("PleaseEnterName")},email:{emailAddressAlreadyInUse:E("emailAddressAlreadyInUse"),PleaseEnterValidEmail:E("PleaseEnterValidEmail")},user:{userNameAlreadyInUse:E("userNameAlreadyInUse"),PleaseChooseUserName:E("PleaseChooseUserName")},pass:{PasswordMinimumLength:E("PasswordMinimumLength"),PasswordsDontMatch:E("PasswordsDontMatch")}}},F=function(){function n(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=a.signup;e(this,n),this.signup=r,this.form=P.getForm(),this.formFields=P.getFormFields(),this.userId=P.getUserId(),this.errorMessages=P.errorMessages,this.userIsLoggedIn=function(e){return t.userId.val()&&""===e}}var a,r,o;return a=n,(r=[{key:"showInvalidEmail",value:function(){this.formFields.email.setCustomValidity(this.errorMessages.email.emailAddressAlreadyInUse),this.form.reportValidity()}},{key:"showInvalidUserName",value:function(){this.formFields.user.setCustomValidity(this.errorMessages.user.userNameAlreadyInUse),this.form.reportValidity()}},{key:"validateForm",value:function(){var e=this.formFields,t=e.name,n=e.email,a=e.user,r=e.pass,o=e.passConfirm;return Object.values(this.formFields).forEach((function(e){e&&e.setCustomValidity("")})),t.validity.tooShort&&t.setCustomValidity(this.errorMessages.name.PleaseEnterName),n.validity.patternMismatch&&n.setCustomValidity(this.errorMessages.email.PleaseEnterValidEmail),a.validity.tooShort&&a.setCustomValidity(this.errorMessages.user.PleaseChooseUserName),!this.userIsLoggedIn()&&r.validity.tooShort&&r.setCustomValidity(this.errorMessages.pass.PasswordMinimumLength),this.signup&&r.value!==o.value&&r.setCustomValidity(this.errorMessages.pass.PasswordsDontMatch),this.form.reportValidity()}}])&&t(a.prototype,r),o&&t(a,o),n}();function C(){}function I(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var N=S((function(){return I(Q(Nogin.Routes.logout),(function(){Y({type:"loggedOut"})}))})),A=S((function(){return D.modal("hide"),I(Q(Nogin.Routes.delete),(function(){Y({type:"accountDeleted"})}))})),M=$('meta[name="csrf-token"]').attr("content");function T(e,t){return function(e,t,n){if(n)return t?t(e()):e();try{var a=Promise.resolve(e());return t?a.then(t):a}catch(e){return Promise.reject(e)}}(e,C,t)}function V(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function U(e){if(e&&e.then)return e.then(C)}function S(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}l().focus();var L=p();L.attr("disabled","disabled");var D=y();s(D).click(S((function(){return U(V((function(){return T(A)}),(function(e){console.error(Nogin._("ErrorFormat",{text:e.text,statusText:e.statusText||""})),Z({message:e.text})})))}))),d().click(S((function(){return U(V((function(){return T(N)}),(function(e){console.error(Nogin._("ErrorFormat",{text:e.text,statusText:e.statusText||""})),Z({type:"ErrorLoggingOut"})})))})));var j,R,X,O,_,B,H,W,q,z,G,J=v();function K(){var e=m();return e[0].value!==e[0].defaultValue}function Q(e){return new Promise((function(t,n){$.ajax(e,{type:"post",headers:{"X-XSRF-Token":M}}).done(t).fail((function(e){var t=new Error("Ajax POST error");t.text=e.responseText,t.responseText=e.statusText,n(t)}))}))}function Y(e){var t=e.type,n=x({type:t});n.modal("show");var a=function(){Nogin.redirect("root")};h(n).click(a),setTimeout(a,3e3)}function Z(e){var t=e.type,n=e.message,a=w({type:t,message:n});a.modal("show");var r=function(){Nogin.redirect("root")};h(a).click(r),setTimeout(r,3e3)}f(J).click((function(){D.modal("show")})),j=!1,R=new F,J[0].addEventListener("submit",(function(e){if(!j&&K()){e.preventDefault(),e.stopPropagation();var t=g({type:"AppearsChangingEmail"});t.modal("show"),s(t).click((function(){j=!0,J.submit(),t.modal("hide")}))}}),!0),X=J,_=(O={validate:function(){R.validateForm()},beforeSubmit:function(e,t,n){return e.push({name:"user",value:L.val()}),!0},success:function(e,t,n,a){"success"===t&&(K()?k():b()).modal("show"),j=!1},error:function(e){switch(j=!1,e.responseText){case"email-taken":R.showInvalidEmail();break;case"session-lost":Z({type:"SessionLost"});break;case"problem-dispatching-link":Z({type:"ProblemDispatchingLink"});break;default:w({type:"FailureSubmittingUserInfo"})}}}).validate,B=O.url,H=O.beforeSubmit,W=O.success,q=O.error,z=O.checkXSRF,G=void 0===z||z,X[0].addEventListener("change",(function(e){_(e)}),!0),X[0].addEventListener("input",(function(e){var t=e.target;t.setCustomValidity(""),t.checkValidity("")}),!0),!G||r||Nogin.disableXSRF?X.ajaxForm({headers:{"X-XSRF-Token":r},url:B,beforeSubmit:H,success:W,error:q}):q({responseText:"UnknownError"})}();
//# sourceMappingURL=homeController.iife.min.js.map
