!function(){"use strict";function e(e,t,n){return Object.defineProperty(e,"prototype",{writable:!1}),e}"undefined"==typeof Error&&(window.Error=e((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})));var t=function(e){var t=e.type,n=e.header,r=e.body,o=e.cancel,a=e.submit,c='[data-confirm-type="'.concat(t,'"][data-name=modal-confirm]');return $(c).modal({show:!1,keyboard:!0,backdrop:!0}),$("".concat(c," .modal-header [data-name=modal-title]")).text(n),$("".concat(c," [data-name=modal-body] p")).empty().append(r),$("".concat(c," .cancel")).text(o).on("click",(function(){$(c).modal("hide")})),$("".concat(c," .submit")).text(a),$(c)},n=function(e){return e.find(".submit")},r=function(e){var t=e.heading,n=e.body,r=e.keyboard,o=e.backdrop,a=$("[data-name=modal-alert]").modal({show:!1,keyboard:r,backdrop:o});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(t),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(n),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),a.modal("hide")})),a},o=Nogin._;function a(e){var t=e.type,n=e.message,a=e.user,c=e.heading;return r({heading:o(c),body:n||o(t,a?{lb:$("<br/>")[0],user:a}:{}),keyboard:!1,backdrop:"static"})}var c=function(e){return e.find("button")},u=function(){return $("button.deleteAccount")},i=function(){return $("button.deleteAllAccounts")},s=function(e){var n=t({type:"deleteAccount",header:o("deleteAccount"),body:o("sureWantDeleteUserAccount",{user:e.user}),cancel:o("cancel"),submit:o("delete")});return n.find(".submit").addClass("btn-danger"),n},d=function(){var e=t({type:"deleteAllAccounts",header:o("deleteAllAccounts"),body:o("reallyWantDeleteAllUserAccounts"),cancel:o("cancel"),submit:o("delete")});return e.find(".submit").addClass("btn-danger"),e},l=function(e){return a({type:e.type,user:e.user,heading:"success"})},f=function(e){var t=e.type,n=e.user;return a({type:t,message:e.message,user:n,heading:"error"})};function m(){}var p=w((function(){return k.modal("hide"),T(P(Nogin.Routes.delete,{user:g.user}),(function(){!function(e){var t=e.type,n=l({type:t,user:g.user});n.modal("show");var r=function(){location.reload(!0)};c(n).on("click",r),setTimeout(r,3e3)}({type:"userAccountDeleted"})}))}));var y=w((function(){return A.modal("hide"),T(P(Nogin.Routes.reset,{user:g.user}),(function(){!function(e){var t=e.type,n=l({type:t});n.modal("show");var r=function(){Nogin.redirect("root")};c(n).on("click",r),setTimeout(r,3e3)}({type:"allUserAccountsDeleted"})}))}));function h(e,t){return function(e,t,n){try{var r=Promise.resolve(e());return t?r.then(t):r}catch(e){return Promise.reject(e)}}(e,m)}var b=$('meta[name="csrf-token"]').attr("content");function v(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var g={user:""};function x(e){if(e&&e.then)return e.then(m)}var k,A=d();function w(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function T(e,t,n){return e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e}function P(e,t){var n={type:"post",headers:{"X-XSRF-Token":b}};return t&&(n.data=t),new Promise((function(t,r){$.ajax(e,n).done(t).fail((function(e){var t=new Error("Ajax POST error");t.text=e.responseText,t.responseText=e.statusText,r(t)}))}))}function E(e){var t=e.type,n=e.message,r=f({type:t,message:n,user:g.user});r.modal("show");var o=function(){location.reload(!0)};c(r).on("click",o),setTimeout(o,3e3)}i().on("click",(function(){n(A).on("click",w((function(){return x(v((function(){return h(y)}),(function(e){var t=e;console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),E({message:t.text})})))}))),A.modal("show")})),u().on("click",(function(e){g.user=e.target.dataset.user,k=s(g),n(k).on("click",w((function(){return x(v((function(){return h(p)}),(function(e){var t=e;console.error(Nogin._("ErrorFormat",{text:t.text,statusText:t.statusText||""})),E({message:t.text})})))}))),k.modal("show")}))}();
//# sourceMappingURL=usersController.iife.min.js.map
