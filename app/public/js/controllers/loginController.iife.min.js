!function(){"use strict";var e=function(e,r){var a=r.validate,s=r.url,t=r.beforeSubmit,o=r.success,i=r.error;return e[0].addEventListener("change",(function(e){a(e)}),!0),e[0].addEventListener("input",(function(e){var r=e.target;r.setCustomValidity(""),r.checkValidity("")}),!0),e.ajaxForm({url:s,beforeSubmit:t,success:o,error:i})},r={getInputForInitialFocus:function(){return $("input:text:visible:first")},getLoginModal:function(){return $("#login")},retrievePasswordModal:function(){var e=$("#retrieve-password");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},retrievePasswordForm:function(e){return e.find("#retrieve-password-form")},getLoginForm:function(){return $("[data-name=login] form")},retrievePasswordSubmit:function(e){return e.find("[data-name=retrieve-password-submit]")},retrievePasswordCancel:function(e){return e.find("[data-name=retrieve-password-cancel]")},retrieveLostPasswordEmail:function(e){return e.find('[data-name="email"]')},getLostPasswordUsername:function(e){return e.find('[data-name="user"]')},getForgotPassword:function(e){return e.find('[data-name="forgot-password"]')},getRememberMeButton:function(e){return e.find("button.remember-me")},isRememberMeChecked:function(e){return this.getRememberMeButton(e).find("span").hasClass("fa-check-square")},setRetrievePasswordCancel:function(e){return this.retrievePasswordCancel(e).text(_("Cancel"))},toggleCheckSquare:function(e){var r=this.getRememberMeButton(e).find("span");r.hasClass("fa-minus-square")?r.removeClass("fa-minus-square").addClass("fa-check-square"):r.addClass("fa-minus-square").removeClass("fa-check-square")},switchConfirmToAlert:function(e){this.retrievePasswordCancel(e).text("OK")}},a={getFormFields:function(){return{user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0]}},errorMessages:{PleaseEnterValidUserName:_("PleaseEnterValidUserName"),PleaseEnterValidPassword:_("PleaseEnterValidPassword"),LoginFailure:_("LoginFailure"),PleaseCheckYourUserNameOrPassword:_("PleaseCheckYourUserNameOrPassword"),MismatchUserDataFormat:_("MismatchUserDataFormat")},messages:{LinkToResetPasswordMailed:_("LinkToResetPasswordMailed"),EmailNotFound:_("EmailNotFound"),ProblemTryAgainLater:_("ProblemTryAgainLater")}};function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var a=0;a<r.length;a++){var s=r[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function o(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}var i=function(e){var r=e.heading,a=e.body,s=e.keyboard,t=e.backdrop;return $("[data-name=modal-alert]").modal({show:!1,keyboard:s,backdrop:t}),$("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(r),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(a),$("[data-name=modal-alert]")},n=a.getFormFields(),d=n.user,l=n.pass,u=function(){function e(){s(this,e)}return o(e,null,[{key:"validateForm",value:function(){return d.validity.valueMissing?(d.setCustomValidity(a.errorMessages.PleaseEnterValidUserName),d.form.reportValidity(),!1):!l.validity.valueMissing||(l.setCustomValidity(a.errorMessages.PleaseEnterValidPassword),l.form.reportValidity(),!1)}},{key:"showLoginError",value:function(e){i({heading:a.errorMessages.LoginFailure,body:e?a.errorMessages[e]:a.errorMessages.PleaseCheckYourUserNameOrPassword,keyboard:!0,backdrop:!0}).modal("show")}}]),e}(),m={getFormFields:function(){return{retrievePasswordModal:$("#retrieve-password"),retrievePasswordAlert:$("#retrieve-password [data-name=alert]"),retrievePasswordForm:$("#retrieve-password #retrieve-password-form")}},addSuccess:function(e){var r=this.getFormFields().retrievePasswordAlert;r.attr("class","alert alert-success"),r.text(e)},messages:{PleaseEnterValidEmailAddress:_("PleaseEnterValidEmailAddress")}},c=function(){function e(){s(this,e);var r=m.getFormFields(),a=r.retrievePasswordModal,t=r.retrievePasswordAlert,o=r.retrievePasswordForm;a.on("show.bs.modal",(function(){o.resetForm(),t.hide()})),this.retrievePasswordAlert=t}return o(e,null,[{key:"validateEmail",value:function(e){return e.setCustomValidity(""),e.validity.patternMismatch&&e.setCustomValidity(m.messages.PleaseEnterValidEmailAddress),e.form.reportValidity()}}]),o(e,[{key:"showEmailAlert",value:function(e){m.addSuccess(e),this.retrievePasswordAlert.show()}},{key:"hideEmailAlert",value:function(){this.retrievePasswordAlert.hide()}},{key:"showEmailSuccess",value:function(e){m.addSuccess(e),this.retrievePasswordAlert.fadeIn(500)}}]),e}(),f=r.getLoginModal(),v=r.getLoginForm(),w=r.getForgotPassword(f),h=r.getRememberMeButton(f),g=r.getLostPasswordUsername(f),P=r.retrievePasswordModal(),b=r.retrieveLostPasswordEmail(P),p=r.retrievePasswordForm(P),F=r.retrievePasswordSubmit(P);F.click((function(){p.submit()})),w.click((function(){r.setRetrievePasswordCancel(P).click((function(){g.focus()})),F.show(),P.modal("show")})),P.on("shown.bs.modal",(function(){b.focus()})),e(v,{validate:function(){u.validateForm()},beforeSubmit:function(e,a,s){return e.push({name:"remember-me",value:r.isRememberMeChecked(f)}),!0},success:function(e,r,a,s){"success"===r&&(location.href=NL_ROUTES.home)},error:function(e){switch(e.responseText){case"unexpected-pass-version-error":u.showLoginError("MismatchUserDataFormat");break;default:u.showLoginError()}}}),r.getInputForInitialFocus().focus(),h.click((function(){r.toggleCheckSquare(f)}));var k=new c;e(p,{validate:function(){var e=b[0];c.validateEmail(e)&&k.hideEmailAlert()},url:NL_ROUTES.lostPassword,success:function(e,s,t,o){r.switchConfirmToAlert(P),F.hide(),k.showEmailSuccess(a.messages.LinkToResetPasswordMailed)},error:function(e){"email-not-found"===e.responseText?k.showEmailAlert(a.messages.EmailNotFound):(console.log(e),r.switchConfirmToAlert(P),F.hide(),k.showEmailAlert(a.messages.ProblemTryAgainLater))}})}();
//# sourceMappingURL=loginController.iife.min.js.map
