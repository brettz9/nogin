!function(){"use strict";var e=$('meta[name="csrf-token"]').attr("content"),r=function(r,t){var a=t.validate,s=t.url,o=t.beforeSubmit,i=t.success,n=t.error,d=t.checkXSRF,l=void 0===d||d;r[0].addEventListener("change",(function(e){a(e)}),!0),r[0].addEventListener("input",(function(e){var r=e.target;r.setCustomValidity(""),r.checkValidity()}),!0),!l||e||Nogin.disableXSRF?r.ajaxForm({headers:{"X-XSRF-Token":e},url:s,beforeSubmit:o,success:i,error:n}):n({responseText:"UnknownError"})},t={getInputForInitialFocus:function(){return $("input:text:visible:first")},getLoginModal:function(){return $("#login")},retrievePasswordModal:function(){var e=$("#retrieve-password");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},retrievePasswordForm:function(e){return e.find("#retrieve-password-form")},getLoginForm:function(){return $("[data-name=login] form")},retrievePasswordSubmit:function(e){return e.find("[data-name=retrieve-password-submit]")},retrievePasswordCancel:function(e){return e.find("[data-name=retrieve-password-cancel]")},retrieveLostPasswordEmail:function(e){return e.find('[data-name="email"]')},getLostPasswordUsername:function(e){return e.find('[data-name="user"]')},getForgotPassword:function(e){return e.find('[data-name="forgot-password"]')},getRememberMeButton:function(e){return e.find("button.remember-me")},isRememberMeChecked:function(e){return this.getRememberMeButton(e).find("span").hasClass("fa-check-square")},setRetrievePasswordCancel:function(e){return this.retrievePasswordCancel(e).text(Nogin._("Cancel"))},toggleCheckSquare:function(e){var r=this.getRememberMeButton(e).find("span");r.hasClass("fa-minus-square")?r.removeClass("fa-minus-square").addClass("fa-check-square"):r.addClass("fa-minus-square").removeClass("fa-check-square")},switchConfirmToAlert:function(e){this.retrievePasswordCancel(e).text("OK")}},a=Nogin._,s={getFormFields:function(){return{user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0]}},errorMessages:{PleaseEnterValidUserName:a("PleaseEnterValidUserName"),PleaseEnterValidPassword:a("PleaseEnterValidPassword"),LoginFailure:a("LoginFailure"),PleaseCheckYourUserNameOrPassword:a("PleaseCheckYourUserNameOrPassword"),MismatchUserDataFormat:a("MismatchUserDataFormat")},messages:{LinkToResetPasswordMailed:a("LinkToResetPasswordMailed"),EmailNotFound:a("EmailNotFound"),ProblemTryAgainLater:a("ProblemTryAgainLater")}},o=function(e){var r=e.heading,t=e.body,a=e.keyboard,s=e.backdrop,o=$("[data-name=modal-alert]").modal({show:!1,keyboard:a,backdrop:s});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(r),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(t),$("[data-name=modal-alert] button").on("click",(function(e){e.preventDefault(),o.modal("hide")})),o},i=s.getFormFields(),n=i.user,d=i.pass,l=function(){return n.validity.valueMissing?(n.setCustomValidity(s.errorMessages.PleaseEnterValidUserName),n.form.reportValidity(),!1):!d.validity.valueMissing||(d.setCustomValidity(s.errorMessages.PleaseEnterValidPassword),d.form.reportValidity(),!1)},u=function(e){o({heading:s.errorMessages.LoginFailure,body:e?s.errorMessages[e]:s.errorMessages.PleaseCheckYourUserNameOrPassword,keyboard:!0,backdrop:!0}).modal("show")};function m(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,r||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}var c={getFormFields:function(){return{retrievePasswordModal:$("#retrieve-password"),retrievePasswordAlert:$("#retrieve-password [data-name=alert]"),retrievePasswordForm:$("#retrieve-password #retrieve-password-form")}},addSuccess:function(e){var r=this.getFormFields().retrievePasswordAlert;r.attr("class","alert alert-success"),r.text(e)},messages:{PleaseEnterValidEmailAddress:Nogin._("PleaseEnterValidEmailAddress")}},f=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e);var r=c.getFormFields(),t=r.retrievePasswordModal,a=r.retrievePasswordAlert,s=r.retrievePasswordForm;t.on("show.bs.modal",(function(){s.resetForm(),a.hide()})),this.retrievePasswordAlert=a}var r,t,a;return r=e,a=[{key:"validateEmail",value:function(e){return e.setCustomValidity(""),e.validity.patternMismatch&&e.setCustomValidity(c.messages.PleaseEnterValidEmailAddress),e.form.reportValidity()}}],(t=[{key:"showEmailAlert",value:function(e){c.addSuccess(e),this.retrievePasswordAlert.show()}},{key:"hideEmailAlert",value:function(){this.retrievePasswordAlert.hide()}},{key:"showEmailSuccess",value:function(e){c.addSuccess(e),this.retrievePasswordAlert.fadeIn(500)}}])&&m(r.prototype,t),a&&m(r,a),Object.defineProperty(r,"prototype",{writable:!1}),e}(),v=t.getLoginModal(),w=t.getLoginForm(),g=t.getForgotPassword(v),h=t.getRememberMeButton(v),P=t.getLostPasswordUsername(v),b=t.retrievePasswordModal(),p=t.retrieveLostPasswordEmail(b),y=t.retrievePasswordForm(b),k=t.retrievePasswordSubmit(b);k.on("click",(function(){y.submit()})),g.on("click",(function(){t.setRetrievePasswordCancel(b).on("click",(function(){b.modal("hide"),setTimeout((function(){P.focus()}))})),k.show(),b.modal("show")})),b.on("shown.bs.modal",(function(){p.focus()})),r(w,{validate:function(){l()},beforeSubmit:function(e){return e.push({name:"remember-me",value:t.isRememberMeChecked(v)}),!0},success:function(e,r){"success"===r&&Nogin.redirect("home")},error:function(e){if("unexpected-pass-version-error"===e.responseText)u("MismatchUserDataFormat");else u()}}),t.getInputForInitialFocus().focus(),h.on("click",(function(){t.toggleCheckSquare(v)}));var F=new f;r(y,{validate:function(){var e=p[0];f.validateEmail(e)&&F.hideEmailAlert()},url:Nogin.Routes.lostPassword,success:function(){t.switchConfirmToAlert(b),k.hide(),F.showEmailSuccess(s.messages.LinkToResetPasswordMailed)},error:function(e){"email-not-found"===e.responseText?F.showEmailAlert(s.messages.EmailNotFound):(console.log(e),t.switchConfirmToAlert(b),k.hide(),F.showEmailAlert(s.messages.ProblemTryAgainLater))}})}();
//# sourceMappingURL=loginController.iife.min.js.map
