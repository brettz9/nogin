!function(){"use strict";var e="undefined"==typeof console?{}:console,r=function(){};["error","log"].forEach((function(a){e[a]||(e[a]=r)}));var a=$('meta[name="csrf-token"]').attr("content"),s=function(e,r){var s=r.validate,t=r.url,o=r.beforeSubmit,i=r.success,n=r.error,d=r.checkXSRF,l=void 0===d||d;e[0].addEventListener("change",(function(e){s(e)}),!0),e[0].addEventListener("input",(function(e){var r=e.target;r.setCustomValidity(""),r.checkValidity("")}),!0),!l||a||Nogin.disableXSRF?e.ajaxForm({headers:{"X-XSRF-Token":a},url:t,beforeSubmit:o,success:i,error:n}):n({responseText:"UnknownError"})},t={getInputForInitialFocus:function(){return $("input:text:visible:first")},getLoginModal:function(){return $("#login")},retrievePasswordModal:function(){var e=$("#retrieve-password");return e.modal({show:!1,keyboard:!0,backdrop:!0}),e},retrievePasswordForm:function(e){return e.find("#retrieve-password-form")},getLoginForm:function(){return $("[data-name=login] form")},retrievePasswordSubmit:function(e){return e.find("[data-name=retrieve-password-submit]")},retrievePasswordCancel:function(e){return e.find("[data-name=retrieve-password-cancel]")},retrieveLostPasswordEmail:function(e){return e.find('[data-name="email"]')},getLostPasswordUsername:function(e){return e.find('[data-name="user"]')},getForgotPassword:function(e){return e.find('[data-name="forgot-password"]')},getRememberMeButton:function(e){return e.find("button.remember-me")},isRememberMeChecked:function(e){return this.getRememberMeButton(e).find("span").hasClass("fa-check-square")},setRetrievePasswordCancel:function(e){return this.retrievePasswordCancel(e).text(Nogin._("Cancel"))},toggleCheckSquare:function(e){var r=this.getRememberMeButton(e).find("span");r.hasClass("fa-minus-square")?r.removeClass("fa-minus-square").addClass("fa-check-square"):r.addClass("fa-minus-square").removeClass("fa-check-square")},switchConfirmToAlert:function(e){this.retrievePasswordCancel(e).text("OK")}},o=Nogin._,i={getFormFields:function(){return{user:$('[data-name="user"]')[0],pass:$('[data-name="pass"]')[0]}},errorMessages:{PleaseEnterValidUserName:o("PleaseEnterValidUserName"),PleaseEnterValidPassword:o("PleaseEnterValidPassword"),LoginFailure:o("LoginFailure"),PleaseCheckYourUserNameOrPassword:o("PleaseCheckYourUserNameOrPassword"),MismatchUserDataFormat:o("MismatchUserDataFormat")},messages:{LinkToResetPasswordMailed:o("LinkToResetPasswordMailed"),EmailNotFound:o("EmailNotFound"),ProblemTryAgainLater:o("ProblemTryAgainLater")}},n=function(e){var r=e.heading,a=e.body,s=e.keyboard,t=e.backdrop,o=$("[data-name=modal-alert]").modal({show:!1,keyboard:s,backdrop:t});return $("[data-name=modal-alert] .modal-header [data-name=modal-title]").text(r),$("[data-name=modal-alert] [data-name=modal-body] p").empty().append(a),$("[data-name=modal-alert] button").click((function(e){e.preventDefault(),o.modal("hide")})),o},d=i.getFormFields(),l=d.user,u=d.pass,c=function(){return l.validity.valueMissing?(l.setCustomValidity(i.errorMessages.PleaseEnterValidUserName),l.form.reportValidity(),!1):!u.validity.valueMissing||(u.setCustomValidity(i.errorMessages.PleaseEnterValidPassword),u.form.reportValidity(),!1)},m=function(e){n({heading:i.errorMessages.LoginFailure,body:e?i.errorMessages[e]:i.errorMessages.PleaseCheckYourUserNameOrPassword,keyboard:!0,backdrop:!0}).modal("show")};function f(e,r){for(var a=0;a<r.length;a++){var s=r[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var v={getFormFields:function(){return{retrievePasswordModal:$("#retrieve-password"),retrievePasswordAlert:$("#retrieve-password [data-name=alert]"),retrievePasswordForm:$("#retrieve-password #retrieve-password-form")}},addSuccess:function(e){var r=this.getFormFields().retrievePasswordAlert;r.attr("class","alert alert-success"),r.text(e)},messages:{PleaseEnterValidEmailAddress:Nogin._("PleaseEnterValidEmailAddress")}},w=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e);var r=v.getFormFields(),a=r.retrievePasswordModal,s=r.retrievePasswordAlert,t=r.retrievePasswordForm;a.on("show.bs.modal",(function(){t.resetForm(),s.hide()})),this.retrievePasswordAlert=s}var r,a,s;return r=e,s=[{key:"validateEmail",value:function(e){return e.setCustomValidity(""),e.validity.patternMismatch&&e.setCustomValidity(v.messages.PleaseEnterValidEmailAddress),e.form.reportValidity()}}],(a=[{key:"showEmailAlert",value:function(e){v.addSuccess(e),this.retrievePasswordAlert.show()}},{key:"hideEmailAlert",value:function(){this.retrievePasswordAlert.hide()}},{key:"showEmailSuccess",value:function(e){v.addSuccess(e),this.retrievePasswordAlert.fadeIn(500)}}])&&f(r.prototype,a),s&&f(r,s),e}(),g=t.getLoginModal(),h=t.getLoginForm(),P=t.getForgotPassword(g),b=t.getRememberMeButton(g),p=t.getLostPasswordUsername(g),k=t.retrievePasswordModal(),F=t.retrieveLostPasswordEmail(k),y=t.retrievePasswordForm(k),E=t.retrievePasswordSubmit(k);E.click((function(){y.submit()})),P.click((function(){t.setRetrievePasswordCancel(k).click((function(){k.modal("hide"),setTimeout((function(){p.focus()}))})),E.show(),k.modal("show")})),k.on("shown.bs.modal",(function(){F.focus()})),s(h,{validate:function(){c()},beforeSubmit:function(e,r,a){return e.push({name:"remember-me",value:t.isRememberMeChecked(g)}),!0},success:function(e,r,a,s){"success"===r&&Nogin.redirect("home")},error:function(e){switch(e.responseText){case"unexpected-pass-version-error":m("MismatchUserDataFormat");break;default:m()}}}),t.getInputForInitialFocus().focus(),b.click((function(){t.toggleCheckSquare(g)}));var C=new w;s(y,{validate:function(){var e=F[0];w.validateEmail(e)&&C.hideEmailAlert()},url:Nogin.Routes.lostPassword,success:function(e,r,a,s){t.switchConfirmToAlert(k),E.hide(),C.showEmailSuccess(i.messages.LinkToResetPasswordMailed)},error:function(e){"email-not-found"===e.responseText?C.showEmailAlert(i.messages.EmailNotFound):(console.log(e),t.switchConfirmToAlert(k),E.hide(),C.showEmailAlert(i.messages.ProblemTryAgainLater))}})}();
//# sourceMappingURL=loginController.iife.min.js.map
